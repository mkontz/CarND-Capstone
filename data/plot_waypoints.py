import matplotlib.pyplot as plt
import numpy as np
from math import acos, pi, sqrt

file = open('sim_waypoints.csv')

x = []
y = []
v = []

for line in file:
	tmp = line.strip().split(',')
	x.append(float(tmp[0]))
	y.append(float(tmp[1]))
	v.append(float(tmp[2]))


wp_x = [805.623,806.507,806.949,807.832,808.716,809.599,810.041,810.923,811.366,812.693,813.578,814.462,814.902,816.229,816.671,817.554,817.998,819.322,820.208,821.093,821.534,822.862,823.747,824.19,825.073,826.4,827.283,827.723,828.609,829.933,830.819,831.26,832.144,833.911,834.351,835.235,835.677,837.446,838.329,838.771,839.655,840.98,841.862,842.746,843.63,844.957,846.283,846.727,848.054,848.938,849.821,850.706,852.03,853.355,853.798,855.564,856.447,857.331,858.214,859.538,860.867,861.307,863.079,863.963,864.846,866.613,867.497,868.381,869.708,871.036,871.919,873.248,874.573,875.898,877.226,878.11,924.691,925.176,926.167,926.931,927.71,928.506,929.046,930.145,930.706,931.274,932.43,933.316,933.615,934.829,935.757,936.701,937.66,937.984,938.964,940.293,941.309,942.339,943.034,943.736,945.158,945.879,946.606,947.708,948.824,949.576,950.717,951.869,952.646,953.823,954.616,955.414,957.027,957.842,958.663,959.077,960.744,962.009,962.434,963.714,965.008,965.441,967.182,968.054,968.925,969.795,971.095,972.394,972.826,974.556,975.42,976.287,977.149,978.443,979.303,980.161,981.447,982.302,983.155,984.012,985.294,986.146,987.0,988.269,989.116,989.958,990.804,992.068,992.909,993.75,995.009,995.847,996.684,997.101,998.771,999.603,1000.02,1001.68,1002.51,1002.92,1003.75,1004.99,1005.82,1006.64,1007.88,1008.7,1009.52,1009.93,1011.58,1012.4,1012.81,1014.04,1014.87,1015.69,1016.1,1017.74,1018.56,1018.97,1020.2,1021.02,1021.84,1022.66,1023.89,1024.71,1025.53,1026.76,1027.58,1027.99,1028.81,1030.04,1030.86,1031.67,1032.49,1033.72,1034.54,1034.94,1035.76,1036.99,1037.81,1038.62,1039.85]
wp_y = [1129.02,1129.01,1129.01,1129.0,1128.99,1128.98,1128.98,1128.97,1128.97,1128.96,1128.95,1128.95,1128.95,1128.94,1128.94,1128.94,1128.93,1128.93,1128.92,1128.92,1128.92,1128.91,1128.91,1128.91,1128.9,1128.9,1128.89,1128.89,1128.89,1128.89,1128.88,1128.88,1128.88,1128.88,1128.88,1128.87,1128.87,1128.87,1128.87,1128.87,1128.86,1128.86,1128.86,1128.86,1128.86,1128.85,1128.85,1128.85,1128.85,1128.84,1128.84,1128.84,1128.84,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.83,1128.96,1128.98,1129.01,1129.04,1129.07,1129.11,1129.13,1129.17,1129.19,1129.22,1129.27,1129.32,1129.33,1129.4,1129.45,1129.51,1129.56,1129.59,1129.65,1129.74,1129.82,1129.9,1129.95,1130.01,1130.14,1130.21,1130.27,1130.38,1130.5,1130.58,1130.71,1130.84,1130.93,1131.08,1131.17,1131.28,1131.48,1131.59,1131.7,1131.75,1131.98,1132.16,1132.22,1132.4,1132.59,1132.66,1132.93,1133.07,1133.2,1133.35,1133.57,1133.79,1133.87,1134.19,1134.35,1134.53,1134.7,1134.97,1135.16,1135.36,1135.66,1135.86,1136.07,1136.29,1136.62,1136.85,1137.09,1137.45,1137.69,1137.94,1138.19,1138.59,1138.85,1139.12,1139.53,1139.81,1140.1,1140.24,1140.82,1141.11,1141.26,1141.86,1142.17,1142.32,1142.63,1143.1,1143.41,1143.73,1144.2,1144.53,1144.85,1145.01,1145.65,1145.98,1146.14,1146.63,1146.95,1147.28,1147.44,1148.1,1148.43,1148.59,1149.08,1149.41,1149.74,1150.07,1150.57,1150.89,1151.22,1151.72,1152.04,1152.21,1152.54,1153.03,1153.36,1153.69,1154.02,1154.52,1154.85,1155.02,1155.36,1155.86,1156.2,1156.54,1157.05]



# fig, axs = plt.subplots(1, 1)
# i1 = 42
# i2 = -14
# # axs.plot(x, y, 'k-o')
# axs.plot(x[i1:i2], y[i1:i2], 'b-o')
# axs.plot(x[i1], y[i1],'go')
# axs.plot(x[i2-1], y[i2-1],'ro')
# axs.plot(wp_x, wp_y, 'r-o')

# axs.axis('equal')

# plt.show()

################################################################

angle = []

for i in range(2,len(x)):
	dx1 = x[i-1] - x[i-2] 
	dx2 = x[i] - x[i-1]
	dy1 = y[i-1] - y[i-2] 
	dy2 = y[i] - y[i-1] 
	l1 = sqrt(dx1*dx1 + dy1*dy1)
	l2 = sqrt(dx2*dx2 + dy2*dy2)
	tmp = max(-1.0, min((dx1 * dx2 + dy1 * dy2) / (l1*l2), 1.0))

	angle.append(acos(tmp)*180 / pi)


dist = []
for i in range(1,len(x)):
	dx = x[i] - x[i-1] 
	dy = y[i] - y[i-1] 
	dist.append(sqrt(dx*dx + dy*dy))

fig, axs = plt.subplots(2, 1)
axs[0].plot(angle)
axs[0].set_ylabel('dth (deg)')
axs[1].plot(dist)
axs[1].set_xlabel('dist (m)')
axs[1].set_ylabel('dx (m)')
plt.show()
